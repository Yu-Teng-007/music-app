# 数据库种子文件使用指南

## 概述

本项目提供了完整的数据库种子文件系统，用于快速初始化数据库并填充基础数据。种子文件包含管理员账号、音乐分类、推荐歌曲和默认播放列表等初始数据。

## 种子文件列表

### 1. 管理员账号种子文件 (`seed-admin-user.ts`)

- **功能**: 创建默认管理员用户账号
- **包含数据**:
  - 开发环境: `admin@musicapp.com` / `admin` / `admin123456`
  - 生产环境: `admin@musicapp.com` / `admin` / `MusicApp@Admin2024!`
- **权限**: 管理员角色，可访问所有功能

### 2. 音乐分类种子文件 (`seed-genres.ts`)

- **功能**: 创建音乐分类/风格的基础数据
- **包含数据**: 15种音乐分类（流行、摇滚、民谣、电子、古典等）
- **特性**: 每个分类包含名称、描述、颜色和图标

### 3. 推荐歌曲种子文件 (`seed-recommended-songs.ts`)

- **功能**: 创建示例音乐推荐数据
- **包含数据**: 40+首不同风格的经典歌曲
- **特性**: 包含华语、英语歌曲，涵盖多种音乐风格

### 4. 默认播放列表种子文件 (`seed-playlists.ts`)

- **功能**: 创建示例播放列表
- **包含数据**: 10个不同主题的播放列表
- **特性**: 按音乐风格和主题分类组织

## 使用方法

### 快速开始

```bash
# 1. 确保数据库已启动并配置正确
npm run env:check

# 2. 运行完整的种子文件初始化
npm run seed

# 3. 或者使用快速种子文件（仅基础数据）
npm run seed:quick
```

### 详细命令

#### 完整种子文件

```bash
# 开发环境（默认）
npm run seed

# 生产环境
npm run seed:prod

# 强制重新创建所有数据
npm run seed:force

# 自定义参数
npm run seed -- --env production --force
```

#### 单独运行种子文件

```bash
# 仅创建管理员账号
npm run seed:admin

# 仅创建音乐分类
npm run seed:genres

# 仅创建推荐歌曲
npm run seed:songs

# 仅创建播放列表
npm run seed:playlists
```

#### 快速种子文件

```bash
# 快速初始化基础数据（适合开发测试）
npm run seed:quick
```

## 命令行参数

### 主种子文件参数

- `--env <environment>`: 指定环境 (`development` | `production`)
- `--force`: 强制重新创建所有数据
- `--no-skip`: 不跳过已存在的数据
- `--help`: 显示帮助信息

### 使用示例

```bash
# 在生产环境运行
npm run seed -- --env production

# 强制重新创建数据
npm run seed -- --force

# 生产环境 + 强制重新创建
npm run seed -- --env production --force
```

## 环境差异

### 开发环境 (development)

- **管理员密码**: `admin123456` (简单密码，便于开发测试)
- **数据量**: 完整的示例数据
- **安全性**: 较低，适合开发调试

### 生产环境 (production)

- **管理员密码**: `MusicApp@Admin2024!` (复杂密码)
- **数据量**: 基础必要数据
- **安全性**: 较高，适合生产部署

## 注意事项

### 安全提醒

1. **生产环境密码**: 请在生产环境部署后立即修改默认管理员密码
2. **数据备份**: 运行种子文件前建议备份现有数据
3. **权限检查**: 确保数据库用户有足够的权限创建表和插入数据

### 常见问题

#### 1. 数据库连接失败

```bash
# 检查数据库配置
npm run env:check

# 确保MySQL服务已启动
# Windows: net start mysql80
# Linux: sudo systemctl start mysql
# macOS: brew services start mysql
```

#### 2. 种子文件运行失败

```bash
# 检查依赖是否安装完整
npm install

# 确保TypeScript编译正常
npm run build
```

#### 3. 数据已存在

```bash
# 跳过已存在的数据（默认行为）
npm run seed

# 强制重新创建数据
npm run seed:force
```

## 数据结构

### 创建的数据统计

- **用户**: 1个管理员账号
- **音乐分类**: 15个分类
- **歌曲**: 40+首示例歌曲
- **播放列表**: 10个主题播放列表

### 数据关系

```
管理员用户 (admin)
├── 创建播放列表 (10个)
│   ├── 华语经典
│   ├── 民谣时光
│   ├── 摇滚精神
│   └── ...
└── 管理权限
    ├── 用户管理
    ├── 内容管理
    └── 系统设置
```

## 开发建议

1. **首次开发**: 使用 `npm run seed:quick` 快速初始化
2. **功能测试**: 使用 `npm run seed` 获取完整测试数据
3. **生产部署**: 使用 `npm run seed:prod` 初始化生产数据
4. **数据重置**: 使用 `npm run seed:force` 重新创建数据

## 扩展种子文件

如需添加新的种子文件：

1. 在 `scripts/` 目录创建新的种子文件
2. 在 `seed-database.ts` 中添加调用
3. 在 `package.json` 中添加对应的npm脚本
4. 更新本文档说明

## 技术实现

- **框架**: NestJS + TypeORM
- **数据库**: MySQL
- **加密**: bcryptjs (密码加密)
- **UUID**: 主键使用UUID格式
- **时区**: 东八区 (+08:00)
