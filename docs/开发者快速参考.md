# ğŸš€ å¼€å‘è€…å¿«é€Ÿå‚è€ƒ

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-06-27  
**é€‚ç”¨äº**: åç«¯æ¨¡å—é‡æ„å

---

## ğŸ“ æ–°æ¨¡å—ç»“æ„é€ŸæŸ¥

### ğŸ—ï¸ æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | è·¯å¾„ | APIå‰ç¼€ | ä¸»è¦åŠŸèƒ½ |
|------|------|---------|----------|
| è®¤è¯æˆæƒ | `src/auth/` | `/auth` | ç™»å½•ã€æ³¨å†Œã€JWTç®¡ç† |
| ç”¨æˆ·ç®¡ç† | `src/users/` | `/users` | ç”¨æˆ·æ¡£æ¡ˆã€åå¥½è®¾ç½® |
| åª’ä½“å¤„ç† | `src/media/` | `/upload`, `/download` | æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ |
| æ­Œæ›²æ•°æ® | `src/songs/` | `/songs` | æ­Œæ›²ä¿¡æ¯ç®¡ç† |
| æ­Œå•ç®¡ç† | `src/playlists/` | `/playlists` | æ­Œå•CRUDæ“ä½œ |

### ğŸ”§ ä¸šåŠ¡æ¨¡å—

| æ¨¡å— | è·¯å¾„ | APIå‰ç¼€ | ä¸»è¦åŠŸèƒ½ |
|------|------|---------|----------|
| æ”¶è—ç®¡ç† | `src/favorites/` | `/favorites` | æ”¶è—æ­Œæ›²ã€æ­Œå• |
| åˆ†ç±»ç®¡ç† | `src/genres/` | `/genres` | éŸ³ä¹ç±»å‹åˆ†ç±» |
| æ’­æ”¾å†å² | `src/history/` | `/history` | æ’­æ”¾è®°å½• |
| æœç´¢å†å² | `src/search-history/` | `/search-history` | æœç´¢è®°å½• |
| ç¤¾äº¤åŠŸèƒ½ | `src/social/` | `/social` | å…³æ³¨ã€åŠ¨æ€ |
| è¯„è®ºç³»ç»Ÿ | `src/comments/` | `/comments` | è¯„è®ºã€å›å¤ |
| å®æ—¶é€šä¿¡ | `src/realtime/` | `/realtime` | WebSocket |
| çŸ­ä¿¡æœåŠ¡ | `src/sms/` | `/sms` | éªŒè¯ç å‘é€ |

---

## ğŸ”— å¸¸ç”¨å¯¼å…¥è·¯å¾„

### å®ä½“ (Entities)
```typescript
import { User } from '../entities/user.entity'
import { Song } from '../entities/song.entity'
import { Playlist } from '../entities/playlist.entity'
import { UserPreference } from '../entities/user-preference.entity'
```

### DTO (æ•°æ®ä¼ è¾“å¯¹è±¡)
```typescript
import { CreateSongDto, UpdateSongDto } from '../dto/song.dto'
import { CreatePlaylistDto } from '../dto/playlist.dto'
import { UpsertPreferenceDto } from '../dto/user-preferences.dto'
```

### æœåŠ¡ (Services)
```typescript
// è®¤è¯æœåŠ¡
import { AuthService } from '../auth/auth.service'

// ç”¨æˆ·åå¥½æœåŠ¡
import { UserPreferencesService } from '../users/preferences/user-preferences.service'

// åª’ä½“æœåŠ¡
import { UploadService } from '../media/upload/upload.service'
import { DownloadService } from '../media/download/download.service'

// ä¸šåŠ¡æœåŠ¡
import { SongsService } from '../songs/songs.service'
import { PlaylistsService } from '../playlists/playlists.service'
```

### å®ˆå« (Guards)
```typescript
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard'
import { LocalAuthGuard } from '../auth/guards/local-auth.guard'
import { RolesGuard } from '../auth/guards/roles.guard'
```

---

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµ

### 1. åˆ›å»ºæ–°åŠŸèƒ½æ¨¡å—

```bash
# 1. åˆ›å»ºæ¨¡å—ç›®å½•
mkdir src/new-module

# 2. ç”Ÿæˆæ¨¡å—æ–‡ä»¶
nest g module new-module
nest g controller new-module
nest g service new-module

# 3. æ›´æ–° app.module.ts
# æ·»åŠ æ–°æ¨¡å—åˆ° imports æ•°ç»„
```

### 2. æ·»åŠ æ–°APIæ¥å£

```typescript
// 1. å®šä¹‰DTO
// src/dto/new-feature.dto.ts
export class CreateFeatureDto {
  @IsString()
  name: string
}

// 2. å®ç°æœåŠ¡æ–¹æ³•
// src/new-module/new-module.service.ts
async createFeature(dto: CreateFeatureDto) {
  // ä¸šåŠ¡é€»è¾‘
}

// 3. æ·»åŠ æ§åˆ¶å™¨æ–¹æ³•
// src/new-module/new-module.controller.ts
@Post()
@ApiOperation({ summary: 'åˆ›å»ºåŠŸèƒ½' })
async create(@Body() dto: CreateFeatureDto) {
  return this.service.createFeature(dto)
}
```

### 3. æ•°æ®åº“æ“ä½œ

```typescript
// 1. æ³¨å…¥Repository
constructor(
  @InjectRepository(Entity)
  private readonly repository: Repository<Entity>
) {}

// 2. å¸¸ç”¨æ“ä½œ
const entity = await this.repository.findOne({ where: { id } })
const entities = await this.repository.find()
const newEntity = await this.repository.save(dto)
await this.repository.delete(id)
```

---

## ğŸ” è°ƒè¯•å’Œæµ‹è¯•

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
cd music-app-backend
npm run start:dev
```

### APIæ–‡æ¡£è®¿é—®
- **Swagger UI**: http://localhost:3000/api/docs
- **APIåŸºç¡€URL**: http://localhost:3000/api

### å¸¸ç”¨æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
npm run test -- --testPathPattern=auth

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov
```

### æ•°æ®åº“æ“ä½œ
```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
npm run migration:generate -- -n MigrationName

# è¿è¡Œè¿ç§»
npm run migration:run

# å›æ»šè¿ç§»
npm run migration:revert
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶

### ç¯å¢ƒå˜é‡ (.env)
```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=password
DB_DATABASE=music_app

# JWTé…ç½®
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760
```

### TypeORMé…ç½®
```typescript
// src/config/database.config.ts
export const databaseConfig = {
  type: 'postgres',
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT),
  username: process.env.DB_USERNAME,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_DATABASE,
  entities: [__dirname + '/../**/*.entity{.ts,.js}'],
  synchronize: process.env.NODE_ENV === 'development',
}
```

---

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### 1. æ¨¡å—å¯¼å…¥é”™è¯¯
```typescript
// âŒ é”™è¯¯çš„å¯¼å…¥è·¯å¾„
import { Service } from './old-path/service'

// âœ… æ­£ç¡®çš„å¯¼å…¥è·¯å¾„
import { Service } from '../new-module/service'
```

### 2. å¾ªç¯ä¾èµ–é—®é¢˜
```typescript
// âŒ é¿å…å¾ªç¯ä¾èµ–
// module-a imports module-b
// module-b imports module-a

// âœ… ä½¿ç”¨forwardRefè§£å†³
@Inject(forwardRef(() => ServiceB))
private serviceB: ServiceB
```

### 3. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
npm run typeorm:check

# é‡æ–°ç”Ÿæˆæ•°æ®åº“
npm run db:drop
npm run db:create
npm run migration:run
```

### 4. ç¼“å­˜é—®é¢˜
```bash
# æ¸…ç†npmç¼“å­˜
npm cache clean --force

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£é“¾æ¥

- ğŸ“– [åç«¯APIæ–‡æ¡£](./åç«¯APIæ–‡æ¡£.md)
- ğŸ—ï¸ [åç«¯æ¨¡å—æ¶æ„æ–‡æ¡£](./åç«¯æ¨¡å—æ¶æ„æ–‡æ¡£.md)
- ğŸ“‹ [APIå˜æ›´è¯´æ˜](./APIå˜æ›´è¯´æ˜.md)
- ğŸ—„ï¸ [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
- ğŸ”’ [JWTè®¤è¯æŠ€æœ¯æ–‡æ¡£](./JWTè®¤è¯æŠ€æœ¯æ–‡æ¡£.md)
- ğŸš€ [éƒ¨ç½²å’Œé…ç½®æ–‡æ¡£](./éƒ¨ç½²å’Œé…ç½®æ–‡æ¡£.md)

---

## ğŸ’¡ æœ€ä½³å®è·µæé†’

1. **ä»£ç è§„èŒƒ**: éµå¾ªESLintå’ŒPrettieré…ç½®
2. **ç±»å‹å®‰å…¨**: å……åˆ†åˆ©ç”¨TypeScriptç±»å‹ç³»ç»Ÿ
3. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸è¿‡æ»¤å™¨
4. **æ—¥å¿—è®°å½•**: åˆç†ä½¿ç”¨Loggerè®°å½•å…³é”®æ“ä½œ
5. **å®‰å…¨é˜²æŠ¤**: å§‹ç»ˆéªŒè¯ç”¨æˆ·è¾“å…¥å’Œæƒé™
6. **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨ç¼“å­˜å’Œæ•°æ®åº“ç´¢å¼•
7. **æµ‹è¯•è¦†ç›–**: ä¸ºå…³é”®ä¸šåŠ¡é€»è¾‘ç¼–å†™æµ‹è¯•
8. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°APIæ–‡æ¡£å’Œæ³¨é‡Š

---

*æœ¬å‚è€ƒæ–‡æ¡£å°†éšç€é¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œå»ºè®®æ”¶è—å¤‡ç”¨ã€‚*
